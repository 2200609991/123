<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAIC 综合运营日报</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      background-color: #f8fafc;
    }
    .tabs-trigger[data-state="active"] {
      background-color: white;
      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    }
    .funnel-step {
        position: relative;
        background-color: #4f46e5;
        color: white;
        padding: 0.75rem;
        margin: 0 auto;
        clip-path: polygon(10% 0, 90% 0, 100% 100%, 0% 100%);
        /* FIX: Added flex properties for centering */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .funnel-arrow {
        color: #4b5563;
        font-weight: 500;
        padding: 0.25rem 0;
    }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
  <div class="max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8">
    <header class="mb-12">
      <h1 class="text-5xl font-bold text-slate-900">MAIC 综合运营日报</h1>
      <p class="text-xl text-slate-600 mt-3">统计日期：2025-07-22</p>
    </header>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-12">
      <!-- KPI Cards -->
      <div class="rounded-xl border bg-white p-6 transition-all duration-300 hover:bg-slate-50">
        <p class="text-lg font-semibold text-slate-800">注册用户数</p>
        <p class="text-4xl font-bold text-slate-900 mt-2">44,473</p>
        <div class="flex items-center text-sm mt-2"><span class="flex items-center font-medium text-emerald-600"><i data-lucide="trending-up" class="h-4 w-4 mr-1"></i>+1.2%</span><span class="text-slate-500 ml-1.5">较昨日</span></div>
      </div>
      <div class="rounded-xl border bg-white p-6 transition-all duration-300 hover:bg-slate-50">
        <p class="text-lg font-semibold text-slate-800">新增用户</p>
        <p class="text-4xl font-bold text-slate-900 mt-2">276</p>
        <div class="flex items-center text-sm mt-2"><span class="flex items-center font-medium text-emerald-600"><i data-lucide="trending-up" class="h-4 w-4 mr-1"></i>+8.5%</span><span class="text-slate-500 ml-1.5">较昨日</span></div>
      </div>
      <div class="rounded-xl border bg-white p-6 transition-all duration-300 hover:bg-slate-50">
        <p class="text-lg font-semibold text-slate-800">活跃用户</p>
        <p class="text-4xl font-bold text-slate-900 mt-2">84</p>
        <div class="flex items-center text-sm mt-2"><span class="flex items-center font-medium text-red-600"><i data-lucide="arrow-down" class="h-4 w-4 mr-1"></i>-3.1%</span><span class="text-slate-500 ml-1.5">较昨日</span></div>
      </div>
      <div class="rounded-xl border bg-white p-6 transition-all duration-300 hover:bg-slate-50">
        <p class="text-lg font-semibold text-slate-800">新用户激活率</p>
        <p class="text-4xl font-bold text-slate-900 mt-2">1.35%</p>
        <div class="flex items-center text-sm mt-2"><span class="flex items-center font-medium text-emerald-600"><i data-lucide="trending-up" class="h-4 w-4 mr-1"></i>+0.15%</span><span class="text-slate-500 ml-1.5">较昨日</span></div>
      </div>
      <div class="rounded-xl border bg-white p-6 transition-all duration-300 hover:bg-slate-50">
        <p class="text-lg font-semibold text-slate-800">次日留存率</p>
        <p class="text-4xl font-bold text-slate-900 mt-2">2.44%</p>
        <div class="flex items-center text-sm mt-2"><span class="flex items-center font-medium text-red-600"><i data-lucide="arrow-down" class="h-4 w-4 mr-1"></i>-0.2%</span><span class="text-slate-500 ml-1.5">较昨日</span></div>
      </div>
      <div class="rounded-xl border bg-white p-6 transition-all duration-300 hover:bg-slate-50">
        <p class="text-lg font-semibold text-slate-800">用户反馈数</p>
        <p class="text-4xl font-bold text-slate-900 mt-2">6</p>
        <div class="flex items-center text-sm mt-2"><span class="flex items-center font-medium text-emerald-600"><i data-lucide="trending-up" class="h-4 w-4 mr-1"></i>+2</span><span class="text-slate-500 ml-1.5">较昨日</span></div>
      </div>
    </div>

    <main class="flex flex-col space-y-10">
      <!-- User Analysis -->
      <div class="shadow-none border rounded-lg bg-white">
        <div class="p-6">
          <h2 class="flex items-center text-2xl font-bold text-slate-900">
            <i data-lucide="users" class="mr-3 h-7 w-7 text-indigo-600"></i>用户分析
          </h2>
        </div>
        <div class="p-6 pt-4">
          <div id="user-analysis-tabs" class="grid w-full grid-cols-2 md:grid-cols-4 mb-6 border p-1 rounded-lg bg-slate-50">
            <button class="tabs-trigger py-2 px-4 text-sm font-medium text-slate-700 rounded-md" data-tab="growth" data-state="active">近7日行为</button>
            <button class="tabs-trigger py-2 px-4 text-sm font-medium text-slate-700 rounded-md" data-tab="retention">留存热力图</button>
            <button class="tabs-trigger py-2 px-4 text-sm font-medium text-slate-700 rounded-md" data-tab="funnel">转化漏斗</button>
            <button class="tabs-trigger py-2 px-4 text-sm font-medium text-slate-700 rounded-md" data-tab="session">会话分布</button>
          </div>
          
          <div id="user-analysis-content">
            <div data-content="growth">
              <div class="h-96"><canvas id="userGrowthChart"></canvas></div>
            </div>
            <div data-content="retention" class="hidden">
              <table class="w-full text-sm text-left text-slate-500"><thead class="text-xs text-slate-700 uppercase bg-slate-50"><tr><th class="px-6 py-3">注册日</th><th class="px-6 py-3">次日</th><th class="px-6 py-3">3日</th><th class="px-6 py-3">7日</th></tr></thead><tbody id="retentionTableBody"></tbody></table>
            </div>
            <div data-content="funnel" class="hidden">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <select id="cohortInstFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"></select>
                <select id="cohortDateFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"></select>
                <input type="date" id="cutoffDateFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"/>
              </div>
              <div id="cohortSummary" class="text-center text-sm text-slate-600 p-2 bg-slate-100 rounded-md mb-4"></div>
              <div id="funnelDisplay" class="max-w-sm mx-auto space-y-0"></div>
            </div>
            <div data-content="session" class="hidden">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <select id="sessionInstFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"></select>
                <select id="sessionCourseFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"></select>
                <select id="sessionSegmentFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"></select>
              </div>
              <div id="sessionSummary" class="text-center text-sm text-slate-600 p-2 bg-slate-100 rounded-md mb-4"></div>
              <div class="h-80"><canvas id="sessionDistributionChart"></canvas></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Content Analysis -->
      <div class="shadow-none border rounded-lg bg-white">
        <div class="p-6">
          <h2 class="flex items-center text-2xl font-bold text-slate-900">
            <i data-lucide="book-open" class="mr-3 h-7 w-7 text-indigo-600"></i>内容分析
          </h2>
        </div>
        <div class="p-6 pt-4">
          <div id="content-analysis-tabs" class="mb-4 border p-1 rounded-lg bg-slate-50 inline-flex">
            <button class="tabs-trigger py-2 px-4 text-sm font-medium text-slate-700 rounded-md" data-tab="courses" data-state="active">课程板块</button>
            <button class="tabs-trigger py-2 px-4 text-sm font-medium text-slate-700 rounded-md" data-tab="institutions">机构板块</button>
          </div>
          <div id="content-analysis-content">
            <div data-content="courses">
              <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-slate-500"><thead class="text-xs text-slate-700 uppercase bg-slate-50"><tr><th class="px-6 py-3">课程名称</th><th class="px-6 py-3">选课人数</th><th class="px-6 py-3">已完课用户</th><th class="px-6 py-3">活跃用户</th><th class="px-6 py-3">用户发言数</th><th class="px-6 py-3">平均学习(页)</th><th class="px-6 py-3">平均发言(次)</th></tr></thead><tbody id="courseTableBody"></tbody></table>
              </div>
            </div>
            <div data-content="institutions" class="hidden">
              <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-slate-500"><thead class="text-xs text-slate-700 uppercase bg-slate-50"><tr><th class="px-6 py-3">机构名称</th><th class="px-6 py-3">课程数</th><th class="px-6 py-3">累计注册</th><th class="px-6 py-3">新增用户</th><th class="px-6 py-3">上课用户</th><th class="px-6 py-3">周期内对话</th><th class="px-6 py-3">累计对话</th></tr></thead><tbody id="institutionTableBody"></tbody></table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Feedback -->
      <div class="shadow-none border rounded-lg bg-white">
        <div class="p-6">
          <h2 class="flex items-center text-2xl font-bold text-slate-900">
            <i data-lucide="message-square" class="mr-3 h-7 w-7 text-indigo-600"></i>用户声音
          </h2>
        </div>
        <div id="feedback-list" class="p-6 pt-0 space-y-6"></div>
      </div>

      <!-- Performance Monitoring -->
      <div class="shadow-none border rounded-lg bg-white">
        <div class="p-6">
          <h2 class="flex items-center text-2xl font-bold text-slate-900">
            <i data-lucide="bar-chart-3" class="mr-3 h-7 w-7 text-indigo-600"></i>平台性能监控
          </h2>
        </div>
        <div class="p-6 pt-0">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
            <select id="perfInstFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"></select>
            <select id="perfCourseFilter" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm"></select>
          </div>
          <table class="w-full text-sm" id="perfTable"></table>
        </div>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      lucide.createIcons();

      // --- Mock Data ---
      const userGrowthData = [{ date: "07-16", 新增用户: 100, 上课用户: 30 },{ date: "07-17", 新增用户: 157, 上课用户: 4 },{ date: "07-18", 新增用户: 133, 上课用户: 2 },{ date: "07-19", 新增用户: 129, 上课用户: 4 },{ date: "07-20", 新增用户: 84, 上课用户: 0 },{ date: "07-21", 新增用户: 123, 上课用户: 2 },{ date: "07-22", 新增用户: 222, 上课用户: 3 }];
      const retentionData = [{ date: "07-21", day1: 2.44, day3: null, day7: null },{ date: "07-20", day1: 2.38, day3: null, day7: null },{ date: "07-18", day1: 3.01, day3: 1.5, day7: null },{ date: "07-17", day1: 1.27, day3: 0.64, day7: null }];
      const cohortFunnelMockData = { all: { "2025-07-21": { totalNewUsers: 123, login: [100, 105], class: [2, 5], speak: [1, 2] }, "2025-07-20": { totalNewUsers: 84, login: [70, 72, 75], class: [2, 5, 8], speak: [1, 2, 3] } }, wisdom_education: { "2025-07-21": { totalNewUsers: 100, login: [80, 85], class: [2, 4], speak: [1, 1] }, "2025-07-20": { totalNewUsers: 70, login: [60, 62, 65], class: [2, 4, 6], speak: [1, 1, 2] } } };
      const sessionMockData = [{ inst: "wisdom_education", course: "course_a", segment: "all_users", values: [60, 150, 100, 50, 25, 10] },{ inst: "wisdom_education", course: "course_a", segment: "new_users", values: [10, 20, 15, 5, 1, 0] },{ inst: "wisdom_education", course: "course_b", segment: "new_users", values: [5, 15, 5, 2, 1, 1] },{ inst: "tsinghua", course: "course_c", segment: "all_users", values: [15, 30, 25, 15, 8, 6] }];
      const courseMeta = { course_a: "迈向通用的人工智能", course_b: "社会心理学", course_c: "大学如何学" };
      const chartLabels = ["0轮", "1轮", "2-3轮", "4-5轮", "6-10轮", "10+轮"];
      const courseData = [{ name: "迈向通用的人工智能", students: 9634, completed: 120, active: 30, posts: 15, avgPages: 15.3, avgPosts: 0.5 },{ name: "MAIC说明书", students: 4115, completed: 281, active: 0, posts: 0, avgPages: 0, avgPosts: 0 },{ name: "社会心理学", students: 2795, completed: 5, active: 7, posts: 0, avgPages: 4.6, avgPosts: 0.0 },{ name: "大学如何学", students: 978, completed: 9, active: 7, posts: 0, avgPages: 6.4, avgPosts: 0.0 },];
      const institutionData = [{ name: "国家智慧教育...", courses: 5, totalReg: 39438, newUsers: 276, classUsers: 65, periodDialog: 969, totalDialog: 267788 },{ name: "清华大学", courses: 18, totalReg: 1785, newUsers: 0, classUsers: 3, periodDialog: 27, totalDialog: 86710 },{ name: "MAIC体验客户", courses: 55, totalReg: 1215, newUsers: 0, classUsers: 9, periodDialog: 176, totalDialog: 30438 },{ name: "MAIC", courses: 27, totalReg: 555, newUsers: 0, classUsers: 3, periodDialog: 80, totalDialog: 3585 },];
      const feedbackData = [{ text: "字幕不显示", time: "14:49", type: "Bug", status: "待处理", username: "user_alpha" },{ text: "字幕卡住了不会翻页", time: "12:00", type: "Bug", status: "处理中", username: "user_beta" },{ text: "音频问题：斜体符号语音模型会读出来", time: "11:51", type: "音频问题", status: "已解决", username: "user_gamma" },{ text: "讲稿区域，英文的换行不能切割单词。", time: "11:51", type: "体验优化", status: "待处理", username: "user_delta" },];
      const perfMockData = { "all-all": { "首响-均值(秒)": 4.93, "首响-中位数(秒)": 4.77, "首响-95分位数(秒)": 7.44, "首响-9999分位数(秒)": 14.31, "首响-最大值(秒)": 14.31, "对话处理时长-均值(秒)": 3.63, "对话处理时长-最大值(秒)": 772.85, "模型调用并发-中位数": 3, "模型调用并发-95分位数": 3, "模型调用并发-最大值": 3, "模型调用并发-最大值时间": "2025-07-22 21:46:13", "对话并发-中位数": 7, "对话并发-95分位数": 7, "对话并发-最大值": 7, "对话并发-最大值时间": "2025-07-22 20:57:09", }, "tsinghua-all": { "首响-均值(秒)": 3.24, "首响-中位数(秒)": 2.97, "首响-95分位数(秒)": 4.65, "首响-9999分位数(秒)": 4.65, "首响-最大值(秒)": 4.65, "对话处理时长-均值(秒)": 1.91, "对话处理时长-最大值(秒)": 73.47, "模型调用并发-中位数": 2, "模型调用并发-95分位数": 2, "模型调用并发-最大值": 2, "模型调用并发-最大值时间": "2025-07-22 19:50:57", "对话并发-中位数": 2, "对话并发-95分位数": 2, "对话并发-最大值": 2, "对话并发-最大值时间": "2025-07-22 19:51:05", }, };

      // --- Tab Switching Logic ---
      function setupTabs(tabsContainerId, contentContainerId) {
        const tabsContainer = document.getElementById(tabsContainerId);
        const contentContainer = document.getElementById(contentContainerId);
        tabsContainer.addEventListener('click', (e) => {
          if (e.target.tagName !== 'BUTTON') return;
          tabsContainer.querySelector('[data-state="active"]').dataset.state = '';
          e.target.dataset.state = 'active';
          for (const child of contentContainer.children) {
            child.classList.add('hidden');
          }
          contentContainer.querySelector(`[data-content="${e.target.dataset.tab}"]`).classList.remove('hidden');
        });
      }
      setupTabs('user-analysis-tabs', 'user-analysis-content');
      setupTabs('content-analysis-tabs', 'content-analysis-content');
      
      // --- User Growth Chart ---
      new Chart(document.getElementById('userGrowthChart'), { type: 'line', data: { labels: userGrowthData.map(d => d.date), datasets: [{ label: '新增用户', data: userGrowthData.map(d => d.新增用户), borderColor: '#4f46e5', backgroundColor: 'rgba(79, 70, 229, 0.1)', fill: true, tension: 0.3 }, { label: '上课用户', data: userGrowthData.map(d => d.上课用户), borderColor: '#d97706', backgroundColor: 'rgba(217, 119, 6, 0.1)', fill: true, tension: 0.3 }] }, options: { responsive: true, maintainAspectRatio: false } });

      // --- Retention Table ---
      const retentionTableBody = document.getElementById('retentionTableBody');
      retentionData.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'bg-white border-b';
        tr.innerHTML = `<td class="px-6 py-4">${row.date}</td><td class="px-6 py-4 ${row.day1 ? 'text-emerald-800 bg-emerald-50 font-medium' : ''}">${row.day1 ? `${row.day1}%` : '-'}</td><td class="px-6 py-4 ${row.day3 ? 'text-emerald-800 bg-emerald-50 font-medium' : ''}">${row.day3 ? `${row.day3}%` : '-'}</td><td class="px-6 py-4 ${row.day7 ? 'text-emerald-800 bg-emerald-50 font-medium' : ''}">${row.day7 ? `${row.day7}%` : '-'}</td>`;
        retentionTableBody.appendChild(tr);
      });

      // --- Cohort Funnel ---
      const cohortInstFilter = document.getElementById('cohortInstFilter');
      const cohortDateFilter = document.getElementById('cohortDateFilter');
      const cutoffDateFilter = document.getElementById('cutoffDateFilter');
      const cohortSummary = document.getElementById('cohortSummary');
      const funnelDisplay = document.getElementById('funnelDisplay');
      function updateCohortFunnel() { const instKey = cohortInstFilter.value; const cohortDateStr = cohortDateFilter.value; const cutoffDateStr = cutoffDateFilter.value; const data = cohortFunnelMockData[instKey]?.[cohortDateStr]; if (!data) { cohortSummary.textContent = "无可用数据"; funnelDisplay.innerHTML = ''; return; } const cohortStartDate = new Date(cohortDateStr + "T00:00:00Z"); const cutoffEndDate = new Date(cutoffDateStr + "T23:59:59Z"); if (cutoffEndDate < cohortStartDate) { cohortSummary.textContent = "截止日期需晚于注册日期"; funnelDisplay.innerHTML = ''; return; } const dayDiff = Math.floor((cutoffEndDate.getTime() - cohortStartDate.getTime()) / (1000 * 60 * 60 * 24)); const totalUsers = data.totalNewUsers; const loginCount = data.login[dayDiff] ?? data.login[data.login.length - 1]; const classCount = data.class[dayDiff] ?? data.class[data.class.length - 1]; const speakCount = data.speak[dayDiff] ?? data.speak[data.speak.length - 1]; cohortSummary.innerHTML = `分析 <b>${cohortDateStr}</b> 注册的 <b>${totalUsers}</b> 人, 在 <b>${dayDiff + 1}</b> 日内的累计转化。`; const steps = [{ label: "注册", value: totalUsers, prev: totalUsers },{ label: "登录", value: loginCount, prev: totalUsers },{ label: "上课", value: classCount, prev: loginCount },{ label: "发言", value: speakCount, prev: classCount }]; const colors = ["#4338ca", "#4f46e5", "#6366f1", "#818cf8"]; funnelDisplay.innerHTML = ''; steps.forEach((step, i) => { const stepConversion = i > 0 && step.prev > 0 ? ((step.value / step.prev) * 100).toFixed(1) : 0; const totalConversion = totalUsers > 0 ? ((step.value / totalUsers) * 100).toFixed(1) : 0; if (i > 0) { funnelDisplay.innerHTML += `<div class="funnel-arrow text-center"><i data-lucide="arrow-down" class="w-4 h-4 mx-auto"></i><span class="text-sm font-medium">${stepConversion}%</span></div>`; } funnelDisplay.innerHTML += `<div class="funnel-step"><div class="font-bold text-lg">${step.label}: ${step.value} 人</div><div class="text-sm opacity-80">总转化率: ${totalConversion}%</div></div>`; }); lucide.createIcons(); }
      cohortInstFilter.innerHTML = `<option value="all">全部机构</option><option value="wisdom_education">国家智慧教育平台</option>`;
      cohortDateFilter.innerHTML = `<option value="2025-07-21">2025-07-21</option><option value="2025-07-20">2025-07-20</option>`;
      cutoffDateFilter.value = "2025-07-23";
      [cohortInstFilter, cohortDateFilter, cutoffDateFilter].forEach(el => el.addEventListener('change', updateCohortFunnel));
      updateCohortFunnel();

      // --- Session Distribution ---
      const sessionInstFilter = document.getElementById('sessionInstFilter');
      const sessionCourseFilter = document.getElementById('sessionCourseFilter');
      const sessionSegmentFilter = document.getElementById('sessionSegmentFilter');
      const sessionSummary = document.getElementById('sessionSummary');
      let sessionChart;
      function updateSessionChart() { let filtered = sessionMockData; if (sessionInstFilter.value !== "all") filtered = filtered.filter(d => d.inst === sessionInstFilter.value); if (sessionCourseFilter.value !== "all") filtered = filtered.filter(d => d.course === sessionCourseFilter.value); if (sessionSegmentFilter.value !== "all_users") filtered = filtered.filter(d => d.segment === sessionSegmentFilter.value); const result = new Array(chartLabels.length).fill(0); filtered.forEach(item => { for (let i = 0; i < result.length; i++) result[i] += item.values[i] || 0 }); const totalUsers = result.reduce((a, b) => a + b, 0); sessionSummary.innerHTML = `总上课用户数: <span class="font-bold">${totalUsers}</span> 人。(“0轮”指进入课程但未对话的用户)`; if (sessionChart) sessionChart.destroy(); sessionChart = new Chart(document.getElementById('sessionDistributionChart'), { type: 'bar', data: { labels: chartLabels, datasets: [{ label: '用户数', data: result, backgroundColor: '#4f46e5' }] }, options: { responsive: true, maintainAspectRatio: false } }); }
      sessionInstFilter.innerHTML = `<option value="all">全部机构</option><option value="wisdom_education">国家智慧教育平台</option><option value="tsinghua">清华大学</option>`;
      sessionCourseFilter.innerHTML = `<option value="all">全部课程</option>` + Object.entries(courseMeta).map(([k, v]) => `<option value="${k}">${v}</option>`).join('');
      sessionSegmentFilter.innerHTML = `<option value="all_users">全部用户</option><option value="new_users">新用户</option><option value="old_users">老用户</option>`;
      [sessionInstFilter, sessionCourseFilter, sessionSegmentFilter].forEach(el => el.addEventListener('change', updateSessionChart));
      updateSessionChart();

      // --- Content Analysis Tables ---
      const courseTableBody = document.getElementById('courseTableBody');
      courseData.forEach(c => {
        const row = courseTableBody.insertRow();
        row.className = 'bg-white border-b';
        row.innerHTML = `<td class="px-6 py-4 font-medium text-slate-900">${c.name}</td><td class="px-6 py-4">${c.students}</td><td class="px-6 py-4">${c.completed}</td><td class="px-6 py-4">${c.active}</td><td class="px-6 py-4">${c.posts}</td><td class="px-6 py-4">${c.avgPages}</td><td class="px-6 py-4">${c.avgPosts}</td>`;
      });
      const institutionTableBody = document.getElementById('institutionTableBody');
      institutionData.forEach(i => {
        const row = institutionTableBody.insertRow();
        row.className = 'bg-white border-b';
        row.innerHTML = `<td class="px-6 py-4 font-medium text-slate-900">${i.name}</td><td class="px-6 py-4">${i.courses}</td><td class="px-6 py-4">${i.totalReg}</td><td class="px-6 py-4">${i.newUsers}</td><td class="px-6 py-4">${i.classUsers}</td><td class="px-6 py-4">${i.periodDialog}</td><td class="px-6 py-4">${i.totalDialog}</td>`;
      });

      // --- Feedback List ---
      const feedbackList = document.getElementById('feedback-list');
      const statusColors = { "待处理": "#f87171", "处理中": "#fb923c", "已解决": "#4ade80" };
      const badgeColors = { "待处理": "bg-red-100 text-red-800", "处理中": "bg-orange-100 text-orange-800", "已解决": "bg-green-100 text-green-800" };
      feedbackData.forEach(item => {
        const div = document.createElement('div');
        div.className = 'relative pl-6 border-l-4';
        div.style.borderColor = statusColors[item.status];
        div.innerHTML = `<p class="text-base font-medium text-slate-800">${item.text}</p><div class="flex justify-between items-center mt-2"><p class="text-sm text-slate-500">${item.username} · ${item.time}</p><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${badgeColors[item.status]}">${item.status}</span></div>`;
        feedbackList.appendChild(div);
      });

      // --- Performance Table ---
      const perfInstFilter = document.getElementById('perfInstFilter');
      const perfCourseFilter = document.getElementById('perfCourseFilter');
      const perfTable = document.getElementById('perfTable');
      function updatePerfTable() {
        const instKey = perfInstFilter.value;
        const courseKey = perfCourseFilter.value;
        const data = perfMockData[`${instKey}-${courseKey}`] || perfMockData[`${instKey}-all`] || perfMockData['all-all'];
        let html = '<tbody>';
        const sections = {
          "首响": ["均值(秒)", "中位数(秒)", "95分位数(秒)", "9999分位数(秒)", "最大值(秒)"],
          "对话处理时长": ["均值(秒)", "最大值(秒)"],
          "模型调用并发": ["中位数", "95分位数", "最大值", "最大值时间"],
          "对话并发": ["中位数", "95分位数", "最大值", "最大值时间"]
        };
        for (const section in sections) {
          html += `<tr class="bg-slate-100 hover:bg-slate-100"><td colspan="2" class="p-3 font-semibold text-slate-800">${section}</td></tr>`;
          sections[section].forEach(metric => {
            const key = `${section}-${metric}`;
            html += `<tr><td class="pl-8 p-3 text-slate-600">${metric}</td><td class="p-3 font-semibold text-slate-900">${data[key] || '-'}</td></tr>`;
          });
        }
        html += '</tbody>';
        perfTable.innerHTML = html;
      }
      perfInstFilter.innerHTML = `<option value="all">全部机构</option><option value="wisdom_education">国家智慧教育平台</option><option value="tsinghua">清华大学</option>`;
      perfCourseFilter.innerHTML = `<option value="all">全部课程</option>` + Object.entries(courseMeta).map(([k,v]) => `<option value="${k}">${v}</option>`).join('');
      [perfInstFilter, perfCourseFilter].forEach(el => el.addEventListener('change', updatePerfTable));
      updatePerfTable();
    });
  </script>
</body>
</html>

